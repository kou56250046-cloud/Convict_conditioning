<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Prisoner Training Tracker</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
    }
    header {
      padding: 16px 24px;
      background: #020617;
      border-bottom: 1px solid #1e293b;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header h1 {
      margin: 0;
      font-size: 20px;
    }
    header small {
      color: #9ca3af;
      font-size: 12px;
    }
    main {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1.1fr 1.2fr;
      gap: 16px;
    }
    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    section {
      background: #020617;
      border-radius: 12px;
      padding: 14px 16px 18px;
      border: 1px solid #1f2937;
    }
    section h2 {
      margin: 0 0 10px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    section h2 span.icon {
      font-size: 18px;
    }
    label {
      font-size: 12px;
      color: #9ca3af;
      display: block;
      margin-bottom: 4px;
    }
    select, input, textarea, button {
      font-family: inherit;
    }
    select, input[type="number"], input[type="date"], textarea {
      width: 100%;
      background: #020617;
      color: #e5e7eb;
      border-radius: 8px;
      border: 1px solid #374151;
      padding: 6px 8px;
      font-size: 13px;
      outline: none;
    }
    select:focus, input:focus, textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }
    textarea {
      resize: vertical;
      min-height: 40px;
    }
    .form-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
    }
    .form-row-3 {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr;
      gap: 8px;
      margin-bottom: 8px;
    }
    .mb-8 { margin-bottom: 8px; }
    .mb-4 { margin-bottom: 4px; }

    button.primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    button.primary:active {
      transform: scale(0.97);
    }
    button.secondary {
      background: #020617;
      border: 1px solid #4b5563;
      color: #e5e7eb;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    button.secondary:active {
      transform: scale(0.97);
    }
    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 6px;
      flex-wrap: wrap;
    }

    /* Calendar */
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .calendar-header h3 {
      margin: 0;
      font-size: 14px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, minmax(0, 1fr));
      gap: 4px;
      font-size: 11px;
    }
    .calendar-cell {
      border-radius: 8px;
      border: 1px solid #111827;
      min-height: 52px;
      padding: 4px;
      background: #020617;
      cursor: pointer;
      position: relative;
    }
    .calendar-cell.today {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34,197,94,0.5);
    }
    .calendar-cell-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
    }
    .calendar-date {
      font-size: 11px;
      color: #9ca3af;
    }
    .calendar-dots {
      display: flex;
      flex-wrap: wrap;
      gap: 2px;
    }
    .dot {
      width: 9px;
      height: 9px;
      border-radius: 999px;
    }
    .weekday-label {
      text-align: center;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 2px;
    }

    /* Legend */
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 11px;
      color: #9ca3af;
    }
    .legend-color {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    /* Charts */
    .charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 900px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
    }
    .chart-card {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #111827;
      padding: 8px;
    }
    .chart-title {
      font-size: 12px;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #9ca3af;
    }
    canvas {
      width: 100%;
      max-width: 100%;
      border-radius: 8px;
      background: #020617;
    }

    /* Weekly summary */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      padding: 4px 6px;
      border-bottom: 1px solid #111827;
      text-align: right;
    }
    th:first-child, td:first-child {
      text-align: left;
    }
    th {
      color: #9ca3af;
      font-weight: 500;
      white-space: nowrap;
    }

    /* Motivation */
    #motivation-message {
      font-size: 13px;
      background: radial-gradient(circle at top left, #22c55e22, transparent 60%);
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px solid #14532d;
      margin-top: 4px;
      color: #bbf7d0;
      white-space: pre-line;
    }

    /* Toast (STEP UP) */
    #stepup-toast {
      position: fixed;
      left: 50%;
      top: 16px;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      padding: 10px 16px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(34,197,94,0.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease, transform 0.3s ease;
      z-index: 50;
    }
    #stepup-toast.show {
      opacity: 1;
      transform: translate(-50%, 0);
    }

    /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º & æ—¥åˆ¥ãƒªã‚¹ãƒˆ */
    #edit-banner {
      display: none;
      margin-bottom: 8px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #f97316;
      background: rgba(248, 113, 113, 0.08);
      font-size: 12px;
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    #edit-banner.visible {
      display: flex;
    }
    #edit-banner span {
      color: #fed7aa;
    }
    #date-entries-wrapper {
      margin-top: 12px;
      border-top: 1px solid #111827;
      padding-top: 8px;
    }
    #date-entries-wrapper h3 {
      margin: 0 0 6px;
      font-size: 13px;
      color: #9ca3af;
    }
    .entry-item {
      border-radius: 8px;
      border: 1px solid #1f2933;
      padding: 6px 8px;
      margin-bottom: 6px;
      background: #020617;
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      align-items: center;
    }
    .entry-main {
      flex: 1;
      min-width: 0;
    }
    .entry-main div {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .entry-actions {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .entry-actions button {
      font-size: 10px;
      padding: 3px 6px;
    }

    /* åè¨€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    #quote-main {
      font-size: 14px;
      line-height: 1.7;
      margin-bottom: 4px;
      white-space: pre-line;
    }
    #quote-meta {
      font-size: 11px;
      color: #9ca3af;
    }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>ãƒ—ãƒªã‚ºãƒŠãƒ¼ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</h1>
      <small>ãƒ“ãƒƒã‚°6 Ã— STEP1ã€œ10 Ã— 365æ—¥ãƒˆãƒ©ãƒƒã‚«ãƒ¼</small>
    </div>
    <div id="today-label"></div>
  </header>

  <main>
    <!-- å·¦ã‚«ãƒ©ãƒ ï¼šå…¥åŠ›ãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
    <div>
      <!-- ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å…¥åŠ› -->
      <section id="input-section">
        <h2><span class="icon">ğŸ‹ï¸â€â™‚ï¸</span> ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h2>

        <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ‰è¡¨ç¤º -->
        <div id="edit-banner">
          <span id="edit-banner-text"></span>
          <button class="secondary" id="cancel-edit-btn">ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <div class="mb-8">
          <label for="date-input">æ—¥ä»˜</label>
          <input type="date" id="date-input" />
        </div>

        <div class="form-row">
          <div>
            <label for="exercise-select">ç¨®ç›®</label>
            <select id="exercise-select"></select>
          </div>
          <div>
            <label for="step-select">STEP</label>
            <select id="step-select"></select>
          </div>
        </div>

        <div class="form-row-3">
          <div>
            <label for="reps-input">ãƒ¬ãƒƒãƒ—ã‚¹æ•°ï¼ˆ1ã‚»ãƒƒãƒˆã‚ãŸã‚Šï¼‰</label>
            <input type="number" id="reps-input" min="1" value="10" />
          </div>
          <div>
            <label for="sets-input">ã‚»ãƒƒãƒˆæ•°</label>
            <input type="number" id="sets-input" min="1" value="3" />
          </div>
          <div>
            <label for="total-display">åˆè¨ˆãƒ¬ãƒƒãƒ—ã‚¹</label>
            <input type="number" id="total-display" readonly />
          </div>
        </div>

        <div class="mb-8">
          <label for="note-input">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
          <textarea id="note-input" placeholder="ãƒ•ã‚©ãƒ¼ãƒ ã®æ„Ÿè¦šã€ä½“èª¿ãªã©"></textarea>
        </div>

        <div class="buttons">
          <button class="primary" id="save-btn">ğŸ’¾ è¨˜éŒ²ã‚’ä¿å­˜</button>
          <button class="secondary" id="clear-today-btn">ä»Šæ—¥ã®å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢</button>
        </div>

        <!-- é¸æŠã—ãŸæ—¥ã®è¨˜éŒ²ä¸€è¦§ -->
        <div id="date-entries-wrapper">
          <h3>ã“ã®æ—¥ã®è¨˜éŒ²ä¸€è¦§</h3>
          <div id="date-entries-list"></div>
        </div>
      </section>

      <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ -->
      <section id="calendar-section">
        <div class="calendar-header">
          <h2><span class="icon">ğŸ“…</span> ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h2>
          <div>
            <button class="secondary" id="prev-month-btn">â† å‰æœˆ</button>
            <button class="secondary" id="next-month-btn">ç¿Œæœˆ â†’</button>
          </div>
        </div>
        <div class="calendar-header">
          <h3 id="calendar-title"></h3>
        </div>
        <div class="calendar-grid" id="weekday-row"></div>
        <div class="calendar-grid" id="calendar-grid"></div>
        <div class="legend" id="legend"></div>
      </section>
    </div>

    <!-- å³ã‚«ãƒ©ãƒ ï¼šé€²æ—ãƒ»é€±æ¬¡ãƒ»åè¨€ãƒ»ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
    <div>
      <!-- é€²æ—ã‚°ãƒ©ãƒ• -->
      <section id="progress-section">
        <h2><span class="icon">ğŸ“ˆ</span> ç¨®ç›®ã”ã¨ã®é€²æ­©ã‚°ãƒ©ãƒ•</h2>
        <div class="charts-grid">
          <div class="chart-card">
            <div class="chart-title">
              <span>ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—</span>
              <span id="step-label-pushup"></span>
            </div>
            <canvas id="chart-pushup" width="400" height="220"></canvas>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              <span>ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ</span>
              <span id="step-label-squat"></span>
            </div>
            <canvas id="chart-squat" width="400" height="220"></canvas>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              <span>ãƒ—ãƒ«ã‚¢ãƒƒãƒ—</span>
              <span id="step-label-pullup"></span>
            </div>
            <canvas id="chart-pullup" width="400" height="220"></canvas>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              <span>ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º</span>
              <span id="step-label-legraise"></span>
            </div>
            <canvas id="chart-legraise" width="400" height="220"></canvas>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              <span>ãƒ–ãƒªãƒƒã‚¸</span>
              <span id="step-label-bridge"></span>
            </div>
            <canvas id="chart-bridge" width="400" height="220"></canvas>
          </div>
          <div class="chart-card">
            <div class="chart-title">
              <span>ãƒãƒ³ãƒ‰ã‚¹ã‚¿ãƒ³ãƒ‰</span>
              <span id="step-label-handstand"></span>
            </div>
            <canvas id="chart-handstand" width="400" height="220"></canvas>
          </div>
        </div>
      </section>

      <!-- ä¸€é€±é–“ã®æˆæœï¼ˆSTEPåˆ¥ï¼‰ -->
      <section id="weekly-section">
        <h2><span class="icon">ğŸ“Š</span> ä¸€é€±é–“ã®æˆæœ</h2>
        <table>
          <thead>
            <tr>
              <th>ç¨®ç›®</th>
              <th>STEP1</th>
              <th>STEP2</th>
              <th>STEP3</th>
              <th>STEP4</th>
              <th>STEP5</th>
              <th>STEP6</th>
              <th>STEP7</th>
              <th>STEP8</th>
              <th>STEP9</th>
              <th>STEP10</th>
              <th>åˆè¨ˆ</th>
            </tr>
          </thead>
          <tbody id="weekly-table-body"></tbody>
        </table>
        <div id="motivation-message"></div>
      </section>

      <!-- æ—¥ã‚ãã‚Šåè¨€ -->
      <section id="quote-section">
        <h2><span class="icon">ğŸ”¥</span> æ—¥ã‚ãã‚Šç­‹ãƒˆãƒ¬åè¨€</h2>
        <div id="quote-main"></div>
        <div id="quote-meta"></div>
        <div class="buttons">
          <button class="secondary" id="next-quote-btn">åˆ¥ã®åè¨€ã‚’è¦‹ã‚‹</button>
        </div>
      </section>

      <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
      <section id="export-section">
        <h2><span class="icon">ğŸ“</span> ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
        <div class="buttons">
          <button class="secondary" id="export-csv-btn">ğŸ“¤ CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
          <button class="secondary" id="reset-all-btn">ğŸ—‘ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
        </div>
      </section>
    </div>
  </main>

  <div id="stepup-toast">STEP UP! ãŠã‚ã§ã¨ã†ï¼</div>

  <script>
    // ====== åè¨€ãƒ‡ãƒ¼ã‚¿ ======
    const QUOTES = [
      {
        text: "é™ç•Œã¯ç­‹è‚‰ãŒæ±ºã‚ã‚‹ã‚“ã˜ã‚ƒãªã„ã€‚\nä»Šæ—¥ã®è‡ªåˆ†ã®è¦šæ‚ŸãŒæ±ºã‚ã‚‹ã€‚",
        author: "ç„¡åã®ãƒãƒ¼ãƒ‰ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼",
        theme: "è¦šæ‚Ÿãƒ»é™ç•Œçªç ´"
      },
      {
        text: "æ‰èƒ½ã¨ã¯ã€Œç¶šã‘ã‚‹æ ¹æ€§ã€ã«\nå¾Œã‹ã‚‰ä»˜ã„ã¦ãã‚‹ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã ã€‚",
        author: "ã©ã“ã‹ã®å¤©æ‰å€™è£œ",
        theme: "æ‰èƒ½ãƒ»ç¶™ç¶š"
      },
      {
        text: "ã‚µãƒœã£ãŸ1æ—¥ã¯ã€\næœªæ¥ã®è‡ªåˆ†ã‹ã‚‰ã®å€Ÿé‡‘ã ã€‚\nåˆ©å­ã¯â€œå¾Œæ‚”â€ã§æ‰•ã†ã“ã¨ã«ãªã‚‹ã€‚",
        author: "æœªæ¥ã®è‡ªåˆ†",
        theme: "ç¶™ç¶šãƒ»è¦šæ‚Ÿ"
      },
      {
        text: "ç­‹è‚‰ã¯è£åˆ‡ã‚‰ãªã„ã€‚\nè£åˆ‡ã£ã¦ãã‚‹ã®ã¯ã€\nã„ã¤ã‚‚è¨€ã„è¨³ã ã‘ã ã€‚",
        author: "ç­‹è‚‰åŸç†ä¸»ç¾©è€…",
        theme: "ç­‹è‚‰ãƒ»è¨€ã„è¨³"
      },
      {
        text: "æ‰èƒ½ã®å·®ã¯ã‚¹ã‚¿ãƒ¼ãƒˆãƒ©ã‚¤ãƒ³ã€‚\næ ¹æ€§ã®å·®ã¯ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã§ã‚ã‹ã‚‹ã€‚",
        author: "ãƒ¬ãƒ¼ã‚¹ã®è¦³å®¢",
        theme: "æ‰èƒ½ãƒ»æ ¹æ€§"
      },
      {
        text: "ã€Œç¶šã‘ã‚‰ã‚Œã‚‹äººã€ã¯\nç‰¹åˆ¥ã˜ã‚ƒãªã„ã€‚\nã‚„ã‚ãªã„ã¨æ±ºã‚ãŸã ã‘ã®\næ™®é€šã®äººã ã€‚",
        author: "ç¶™ç¶šä¸­æ¯’è€…",
        theme: "ç¶™ç¶š"
      },
      {
        text: "ã‚ãã‚‰ã‚ã‚‹ç†ç”±ãŒ\n100å€‹ã‚ã£ã¦ã‚‚ã„ã„ã€‚\nç¶šã‘ã‚‹ç†ç”±ã‚’\n1å€‹ã ã‘æ¡ã‚Šã—ã‚ã¦ã„ã‚Œã°å‹ã¡ã ã€‚",
        author: "å´–ã£ã·ã¡ã®æŒ‘æˆ¦è€…",
        theme: "ã‚ãã‚‰ã‚ãªã„å¿ƒ"
      },
      {
        text: "è‡ªä¿¡ã¯\nã€Œã§ããŸå›æ•°ã€ã®è²¯é‡‘ã ã€‚\nä»Šæ—¥ã®1ãƒ¬ãƒƒãƒ—ãŒã€\næ˜æ—¥ã®ãƒ‰ãƒ¤é¡”ã‚’ä½œã‚‹ã€‚",
        author: "è‡ªæ„è­˜ãƒãƒƒãƒãƒ§",
        theme: "è‡ªä¿¡ãƒ»åŠªåŠ›"
      },
      {
        text: "åŠªåŠ›ã¯\nè£åˆ‡ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã€‚\nã§ã‚‚ã€\nã‚µãƒœã‚Šã¯ä¸€åº¦ã‚‚\nè£åˆ‡ã£ãŸã“ã¨ãŒãªã„ã€‚",
        author: "åçœä¼šã®å¸¸é€£",
        theme: "åŠªåŠ›ãƒ»ã‚µãƒœã‚Š"
      },
      {
        text: "ç­‹è‚‰ç—›ã¯ã€\næ˜¨æ—¥ã®è‡ªåˆ†ã‹ã‚‰å±Šã„ãŸ\nåˆæ ¼é€šçŸ¥ã ã€‚",
        author: "DOMSãƒ©ãƒãƒ¼",
        theme: "ç­‹è‚‰ãƒ»é›éŒ¬"
      },
      {
        text: "ã€Œã¾ã ã„ã‘ã‚‹ã‹ï¼Ÿã€ã˜ã‚ƒãªã„ã€‚\nã€Œã“ã“ã‹ã‚‰ãŒæœ¬ç•ªã ã‚ï¼Ÿã€ã ã€‚",
        author: "è¿½ã„è¾¼ã¿ç•ªé•·",
        theme: "æ ¹æ€§ãƒ»è¿½ã„è¾¼ã¿"
      },
      {
        text: "æ‰èƒ½ãŒãƒ‰ã‚¢ã‚’å©ãã®ã‚’\nå¾…ã£ã¦ã„ã‚‹æš‡ãŒã‚ã‚‹ãªã‚‰ã€\nä»Šã®è‡ªåˆ†ã§ãƒ‰ã‚¢ã‚’ã¶ã¡ç ´ã‚Œã€‚",
        author: "å£Šã—å±‹ãƒ¡ãƒ³ã‚¿ãƒªã‚¹ãƒˆ",
        theme: "æ‰èƒ½ãƒ»è¡Œå‹•"
      },
      {
        text: "è¦šæ‚Ÿã¨ã¯ã€\nã€Œé€ƒã’é“ã‚’æ¶ˆã™ã€ã“ã¨ã˜ã‚ƒãªã„ã€‚\nã€Œé€ƒã’ã¦ã‚‚ã¾ãŸæˆ»ã‚‹ã€ã¨\næ±ºã‚ã¦ã„ã‚‹å¿ƒã ã€‚",
        author: "å‡ºæˆ»ã‚Šæˆ¦å£«",
        theme: "è¦šæ‚Ÿãƒ»ç¶™ç¶š"
      },
      {
        text: "ç¶šã‘ãŸå¥´ã ã‘ãŒçŸ¥ã£ã¦ã„ã‚‹ã€‚\nä¸‰æ—¥åŠä¸»ã«ã¯è¦‹ãˆãªã„æ™¯è‰²ãŒã€\nå››æ—¥ç›®ã«æ€¥ã«æ¥ã‚‹ã€‚",
        author: "å››æ—¥ç›®ã®ä½äºº",
        theme: "ç¶™ç¶š"
      },
      {
        text: "ç­‹ãƒˆãƒ¬ã¯\nã€Œæ˜æ—¥ã‚«ãƒƒã‚³ã‚ˆããªã‚‹å„€å¼ã€ã˜ã‚ƒãªã„ã€‚\nã€Œä»Šã“ã“ã§\nè‡ªåˆ†ã‚’å¥½ãã«ãªã‚‹å„€å¼ã€ã ã€‚",
        author: "è‡ªå°Šå¿ƒãƒ“ãƒ«ãƒ€ãƒ¼",
        theme: "ç­‹è‚‰ãƒ»è‡ªä¿¡"
      },
      {
        text: "é™ç•Œã ã¨æ€ã£ãŸå›æ•°ã‹ã‚‰å…ˆãŒã€\nâ€œåŠªåŠ›â€ã§ã€\nãã‚Œã¾ã§ã¯å…¨éƒ¨â€œæº–å‚™é‹å‹•â€ã ã€‚",
        author: "é¬¼ã‚³ãƒ¼ãƒã®ä¸­ã®äºº",
        theme: "åŠªåŠ›ãƒ»é™ç•Œ"
      },
      {
        text: "ã‚ãã‚‰ã‚ãªã„å¿ƒã¯ã€\nä¸€åº¦æ±ºã‚ãŸã‚‰\nä¸€ç”ŸéŒ†ã³ãªã„ã€‚\néŒ†ã³ã‚‹ã®ã¯\næ±ºæ„ã˜ã‚ƒãªãã¦è¨€ã„è¨³ã ã€‚",
        author: "ãƒãƒãƒ¼ã‚®ãƒ–ã‚¢ãƒƒãƒ‘ãƒ¼",
        theme: "ã‚ãã‚‰ã‚ãªã„å¿ƒ"
      },
      {
        text: "ã€Œã‚»ãƒ³ã‚¹ãŒãªã„ã€ã¯\nä»Šæ—¥ã‚µãƒœã‚‹ãŸã‚ã®\nä¸€ç•ªã‚ªã‚·ãƒ£ãƒ¬ãªè¨€ã„è¨³ã ã€‚",
        author: "æ¯’èˆŒãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼",
        theme: "æ‰èƒ½ãƒ»è¨€ã„è¨³"
      },
      {
        text: "æ ¹æ€§ã¨ã¯ã€\nå¿ƒãŒæŠ˜ã‚Œã¦ã‚‚\nè¡Œå‹•ã ã‘ã¯æŠ˜ã‚‰ãªã„ã“ã¨ã ã€‚",
        author: "æŠ˜ã‚Œã¾ãã‚ŠçµŒé¨“è€…",
        theme: "æ ¹æ€§ãƒ»è¡Œå‹•"
      },
      {
        text: "ç¶™ç¶šã®ã‚³ãƒ„ã¯ä¸€ã¤ã ã‘ã€‚\nã€Œã‚„ã‚‹ã‹ã€ã€Œã‚‚ã£ã¨ã‚„ã‚‹ã‹ã€ã®\näºŒæŠã—ã‹æŒãŸãªã„ã“ã¨ã ã€‚",
        author: "äºŒæŠãƒãƒ‹ã‚¢",
        theme: "ç¶™ç¶šãƒ»é›éŒ¬"
      },
      {
        text: "è‡ªä¿¡ã¯\nçµæœã‹ã‚‰ã˜ã‚ƒãªãã€\nã€Œã“ã“ã¾ã§ã‚„ã£ãŸè‡ªåˆ†ã€ã‚’\nè£åˆ‡ã‚‰ãªã‹ã£ãŸè¨˜æ†¶ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã€‚",
        author: "è¨˜æ†¶ã‚³ãƒ¬ã‚¯ã‚¿ãƒ¼",
        theme: "è‡ªä¿¡ãƒ»åŠªåŠ›"
      },
      {
        text: "ä»Šæ—¥ã‚µãƒœã‚Œã°\næ¥½ã«ã¯ãªã‚‹ã€‚\nã§ã‚‚ã€Œè‡ªåˆ†ã£ã¦ã“ã†ã ã‚ˆãªã€ãŒ\nã©ã‚“ã©ã‚“ã‚·ãƒ§ãƒœããªã‚‹ã€‚",
        author: "å…ƒãƒ»è¨€ã„è¨³è·äºº",
        theme: "è‡ªåˆ†åƒãƒ»è¦šæ‚Ÿ"
      },
      {
        text: "ç­‹è‚‰ã¯\nã‚¦ã‚½ã‚’ã¤ã‹ãªã„ã‘ã©ã€\nã‚µãƒœã‚Šç¶šã‘ã‚‹ã¨\nä½•ã‚‚èªã£ã¦ãã‚Œãªããªã‚‹ã€‚",
        author: "ç­‹è‚‰ã¨ã®åˆ¥ã‚Œã‚’çµŒé¨“ã—ãŸäºº",
        theme: "ç­‹è‚‰ãƒ»ç¶™ç¶š"
      },
      {
        text: "æ‰èƒ½ã¯ã‚¹ã‚¿ãƒ¼ãƒˆãƒ€ãƒƒã‚·ãƒ¥ã€\næ ¹æ€§ã¯æœ€å¾Œã®ä¸€æ­©ã€‚\nãƒ¬ãƒ¼ã‚¹ã‚’æ±ºã‚ã‚‹ã®ã¯\nã„ã¤ã‚‚â€œæœ€å¾Œã®ä¸€æ­©â€ã ã€‚",
        author: "ã‚´ãƒ¼ãƒ«ãƒ†ãƒ¼ãƒ—ã®ç›®æ’ƒè€…",
        theme: "æ‰èƒ½ãƒ»æ ¹æ€§"
      },
      {
        text: "é›éŒ¬ã¨ã¯ã€\nã€Œä»Šæ—¥ã‚‚ã‚„ã£ãŸã€ã¨ã„ã†\nå°ã•ã„èª‡ã‚Šã‚’\nåœ°å±¤ã¿ãŸã„ã«ç©ã¿ä¸Šã’ã‚‹ä½œæ¥­ã ã€‚",
        author: "èª‡ã‚Šã®åœ°è³ªå­¦è€…",
        theme: "é›éŒ¬ãƒ»ç¶™ç¶š"
      },
      {
        text: "è¦šæ‚Ÿã‚’æ±ºã‚ã‚‹ã®ã«\nãƒ‰ãƒ©ãƒãƒãƒƒã‚¯ãªç†ç”±ã¯ã„ã‚‰ãªã„ã€‚\nã€Œãã‚ãã‚æœ¬æ°—å‡ºã™ã‹ã€ã§ååˆ†ã ã€‚",
        author: "ãã£ã‹ã‘è·äºº",
        theme: "è¦šæ‚Ÿ"
      },
      {
        text: "ã‚ãã‚‰ã‚ãªã‹ã£ãŸäººé–“ã ã‘ãŒã€\nã€Œã‚„ã‚ãªãã¦ã‚ˆã‹ã£ãŸã€ã¨\næœªæ¥å½¢ã§ç¬‘ãˆã‚‹ã€‚",
        author: "æœªæ¥ã‹ã‚‰æ¥ãŸãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ¼",
        theme: "ã‚ãã‚‰ã‚ãªã„å¿ƒ"
      },
      {
        text: "åŠªåŠ›ã¯å ±ã‚ã‚Œãªã„ã“ã¨ã‚‚ã‚ã‚‹ã€‚\nã§ã‚‚â€œåŠªåŠ›ã—ãªã‹ã£ãŸè‡ªåˆ†â€ã ã‘ã¯\nä¸€ç”Ÿè¨±ã›ãªã„ã€‚",
        author: "è‡ªå·±æ¡ç‚¹ã®é¬¼",
        theme: "åŠªåŠ›ãƒ»å¾Œæ‚”"
      },
      {
        text: "è‡ªä¿¡ã‚’ã¤ã‘ãŸã„ãªã‚‰ã€\nçµæœã‚’ã„ã˜ã‚‹ãªã€‚\nä»Šæ—¥ã®è¡Œå‹•ã‚’ã„ã˜ã‚Œã€‚",
        author: "ç¾å®Ÿä¸»ç¾©ã®å¤¢è¿½ã„äºº",
        theme: "è‡ªä¿¡ãƒ»è¡Œå‹•"
      },
      {
        text: "ç­‹è‚‰ã¯\néå»ã®è‡ªåˆ†ã‹ã‚‰ã®\nãƒ©ãƒ–ãƒ¬ã‚¿ãƒ¼ã ã€‚\nã‚µãƒœã‚Œã°ã€\nã„ããªã‚ŠéŸ³ä¿¡ä¸é€šã«ãªã‚‹ã€‚",
        author: "ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãƒœãƒ‡ã‚£",
        theme: "ç­‹è‚‰ãƒ»ç¶™ç¶š"
      },
      {
        text: "ã€Œã¾ã æœ¬æ°—å‡ºã—ã¦ãªã„ã ã‘ã€ã¯ã€\næœ¬æ°—ã‚’ä¸€åº¦ã‚‚å‡ºã—ãŸã“ã¨ãŒãªã„äººã®\næ±ºã¾ã‚Šæ–‡å¥ã ã€‚",
        author: "é¬¼ç•œç¾å®Ÿã•ã‚“",
        theme: "è¦šæ‚Ÿãƒ»è¡Œå‹•"
      },
      {
        text: "ç¶™ç¶šã¨ã¯ã€\nâ€œæ˜¨æ—¥ã¾ã§ã®è‡ªåˆ†â€ã«\nå®¹èµ¦ãªãæœŸå¾…ã—ç¶šã‘ã‚‹å‹‡æ°—ã ã€‚",
        author: "æœŸå¾…ã—ç¶šã‘ã‚‹äºº",
        theme: "ç¶™ç¶šãƒ»å‹‡æ°—"
      }
    ];

    // ====== å®šæ•°ãƒ»çŠ¶æ…‹ ======
    const EXERCISES = [
      { key: "pushup", label: "ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—", color: "#f97373" },
      { key: "squat", label: "ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ", color: "#fb923c" },
      { key: "pullup", label: "ãƒ—ãƒ«ã‚¢ãƒƒãƒ—", color: "#3b82f6" },
      { key: "legraise", label: "ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º", color: "#22c55e" },
      { key: "bridge", label: "ãƒ–ãƒªãƒƒã‚¸", color: "#a855f7" },
      { key: "handstand", label: "ãƒãƒ³ãƒ‰ã‚¹ã‚¿ãƒ³ãƒ‰", color: "#eab308" }
    ];

    const STORAGE_KEY_LOGS = "pt_logs_v1";
    const STORAGE_KEY_STEPS = "pt_steps_v1";

    const STEPUP_MIN_SETS = 3;
    const STEPUP_MIN_TOTAL_REPS = 30;

    let logs = [];
    let currentSteps = {};
    let currentMonth = {};
    let editingId = null;
    let quoteOffset = 0;

    function todayISO() {
      const d = new Date();
      const year = d.getFullYear();
      const month = String(d.getMonth() + 1).padStart(2, "0");
      const day = String(d.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function parseISO(dateStr) {
      const [y, m, d] = dateStr.split("-").map(Number);
      return new Date(y, m - 1, d);
    }

    function formatMonthTitle(year, month) {
      return `${year}å¹´${month}æœˆ`;
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs));
      localStorage.setItem(STORAGE_KEY_STEPS, JSON.stringify(currentSteps));
    }

    function loadState() {
      const logsJson = localStorage.getItem(STORAGE_KEY_LOGS);
      logs = logsJson ? JSON.parse(logsJson) : [];
      const stepsJson = localStorage.getItem(STORAGE_KEY_STEPS);
      if (stepsJson) {
        currentSteps = JSON.parse(stepsJson);
      } else {
        EXERCISES.forEach(ex => currentSteps[ex.key] = 1);
      }
    }

    function showStepUpToast(message) {
      const toast = document.getElementById("stepup-toast");
      toast.textContent = message;
      toast.classList.add("show");
      setTimeout(() => {
        toast.classList.remove("show");
      }, 2500);
    }

    function calcStreak() {
      if (logs.length === 0) return 0;
      const datesSet = new Set(logs.map(l => l.date));
      let streak = 0;
      let day = parseISO(todayISO());
      while (true) {
        const y = day.getFullYear();
        const m = String(day.getMonth() + 1).padStart(2, "0");
        const d = String(day.getDate()).padStart(2, "0");
        const iso = `${y}-${m}-${d}`;
        if (datesSet.has(iso)) {
          streak++;
          day.setDate(day.getDate() - 1);
        } else {
          break;
        }
      }
      return streak;
    }

    function getWeekRange(offsetWeeks = 0) {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const mondayOffset = (dayOfWeek + 6) % 7;
      const monday = new Date(today);
      monday.setDate(today.getDate() - mondayOffset + offsetWeeks * 7);
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);

      const toISO = d => {
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const da = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${da}`;
      };

      return { start: toISO(monday), end: toISO(sunday) };
    }

    function isBetween(dateStr, startIso, endIso) {
      return dateStr >= startIso && dateStr <= endIso;
    }

    function getDayOfYear(date) {
      const start = new Date(date.getFullYear(), 0, 0);
      const diff = date - start;
      const oneDay = 1000 * 60 * 60 * 24;
      return Math.floor(diff / oneDay);
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
    function renderWeekdays() {
      const weekdayRow = document.getElementById("weekday-row");
      weekdayRow.innerHTML = "";
      const names = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
      names.forEach(n => {
        const div = document.createElement("div");
        div.className = "weekday-label";
        div.textContent = n;
        weekdayRow.appendChild(div);
      });
    }

    function renderCalendar() {
      const grid = document.getElementById("calendar-grid");
      grid.innerHTML = "";

      const { year, month } = currentMonth;
      document.getElementById("calendar-title").textContent = formatMonthTitle(year, month);

      const firstDay = new Date(year, month - 1, 1);
      const firstWeekday = firstDay.getDay();
      const daysInMonth = new Date(year, month, 0).getDate();

      const logsByDate = {};
      logs.forEach(l => {
        if (!logsByDate[l.date]) logsByDate[l.date] = [];
        logsByDate[l.date].push(l);
      });

      const todayIso = todayISO();

      for (let i = 0; i < firstWeekday; i++) {
        const cell = document.createElement("div");
        grid.appendChild(cell);
      }

      for (let date = 1; date <= daysInMonth; date++) {
        const cell = document.createElement("div");
        cell.className = "calendar-cell";
        const iso = `${year}-${String(month).padStart(2, "0")}-${String(date).padStart(2, "0")}`;
        if (iso === todayIso) {
          cell.classList.add("today");
        }

        const header = document.createElement("div");
        header.className = "calendar-cell-header";

        const dateSpan = document.createElement("span");
        dateSpan.className = "calendar-date";
        dateSpan.textContent = date;

        header.appendChild(dateSpan);
        cell.appendChild(header);

        const dotsContainer = document.createElement("div");
        dotsContainer.className = "calendar-dots";

        const dayLogs = logsByDate[iso] || [];
        const exercisesUsed = new Set(dayLogs.map(l => l.exercise));
        let count = 0;
        exercisesUsed.forEach(exKey => {
          const exInfo = EXERCISES.find(e => e.key === exKey);
          const dot = document.createElement("div");
          dot.className = "dot";
          dot.style.backgroundColor = exInfo ? exInfo.color : "#6b7280";
          dotsContainer.appendChild(dot);
          count++;
        });
        if (count === 0) {
          const empty = document.createElement("span");
          empty.style.fontSize = "10px";
          empty.style.color = "#374151";
          empty.textContent = "-";
          dotsContainer.appendChild(empty);
        }

        cell.appendChild(dotsContainer);
        cell.addEventListener("click", () => {
          const dateInput = document.getElementById("date-input");
          dateInput.value = iso;
          dateInput.dispatchEvent(new Event("change"));
        });

        grid.appendChild(cell);
      }
    }

    function renderLegend() {
      const legend = document.getElementById("legend");
      legend.innerHTML = "";
      EXERCISES.forEach(ex => {
        const item = document.createElement("div");
        item.className = "legend-item";
        const colorBox = document.createElement("div");
        colorBox.className = "legend-color";
        colorBox.style.backgroundColor = ex.color;
        const label = document.createElement("span");
        label.textContent = ex.label;
        item.appendChild(colorBox);
        item.appendChild(label);
        legend.appendChild(item);
      });
    }

    // ã‚°ãƒ©ãƒ•
    function drawExerciseChart(exKey) {
      const canvas = document.getElementById("chart-" + exKey);
      if (!canvas) return;
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const filtered = logs.filter(l => l.exercise === exKey);
      if (filtered.length === 0) {
        ctx.fillStyle = "#6b7280";
        ctx.font = "12px sans-serif";
        ctx.fillText("ãƒ‡ãƒ¼ã‚¿ãªã—", 10, 20);
        return;
      }

      const byDate = {};
      filtered.forEach(l => {
        if (!byDate[l.date]) byDate[l.date] = 0;
        byDate[l.date] += l.totalReps;
      });

      const dates = Object.keys(byDate).sort();
      const values = dates.map(d => byDate[d]);

      const paddingLeft = 30;
      const paddingBottom = 22;
      const paddingTop = 10;
      const paddingRight = 10;
      const W = canvas.width;
      const H = canvas.height;

      const maxY = Math.max(...values, 1);

      ctx.strokeStyle = "#374151";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(paddingLeft, paddingTop);
      ctx.lineTo(paddingLeft, H - paddingBottom);
      ctx.lineTo(W - paddingRight, H - paddingBottom);
      ctx.stroke();

      ctx.fillStyle = "#6b7280";
      ctx.font = "10px sans-serif";
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      ctx.fillText(String(maxY), paddingLeft - 4, paddingTop + 4);
      ctx.fillText(String(Math.round(maxY / 2)), paddingLeft - 4, (H - paddingBottom + paddingTop) / 2);

      ctx.strokeStyle = "#38bdf8";
      ctx.lineWidth = 2;
      ctx.beginPath();
      dates.forEach((d, i) => {
        const x = paddingLeft + (dates.length === 1 ? (W - paddingLeft - paddingRight) / 2 : (W - paddingLeft - paddingRight) * (i / (dates.length - 1)));
        const y = (H - paddingBottom) - (H - paddingBottom - paddingTop) * (values[i] / maxY);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      ctx.fillStyle = "#f97316";
      dates.forEach((d, i) => {
        const x = paddingLeft + (dates.length === 1 ? (W - paddingLeft - paddingRight) / 2 : (W - paddingLeft - paddingRight) * (i / (dates.length - 1)));
        const y = (H - paddingBottom) - (H - paddingBottom - paddingTop) * (values[i] / maxY);
        ctx.beginPath();
        ctx.arc(x, y, 3, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function renderAllCharts() {
      EXERCISES.forEach(ex => {
        drawExerciseChart(ex.key);
        const label = document.getElementById("step-label-" + ex.key);
        if (label) {
          label.textContent = "STEP " + (currentSteps[ex.key] || 1);
        }
      });
    }

    // ä¸€é€±é–“ã®æˆæœï¼ˆSTEPåˆ¥ï¼‰
    function renderWeeklyComparison() {
      const tbody = document.getElementById("weekly-table-body");
      tbody.innerHTML = "";

      const thisWeek = getWeekRange(0);

      EXERCISES.forEach(ex => {
        const stepTotals = new Array(11).fill(0); // 1ã€œ10ã‚’ä½¿ç”¨

        logs.forEach(l => {
          if (l.exercise !== ex.key) return;
          if (!isBetween(l.date, thisWeek.start, thisWeek.end)) return;

          let s = Number(l.step) || 0;
          if (s < 1) s = 1;
          if (s > 10) s = 10;
          stepTotals[s] += l.totalReps;
        });

        const tr = document.createElement("tr");
        const nameTd = document.createElement("td");
        nameTd.textContent = ex.label;
        tr.appendChild(nameTd);

        let weekSum = 0;
        for (let s = 1; s <= 10; s++) {
          const td = document.createElement("td");
          const v = stepTotals[s];
          td.textContent = v > 0 ? v : "";
          tr.appendChild(td);
          weekSum += v;
        }
        const totalTd = document.createElement("td");
        totalTd.textContent = weekSum;
        tr.appendChild(totalTd);

        tbody.appendChild(tr);
      });

      const streak = calcStreak();
      const totalLogs = logs.length;
      const msg = document.getElementById("motivation-message");
      if (totalLogs === 0) {
        msg.textContent = "ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»Šæ—¥ãŒ â€œ1æ—¥ç›®â€ ã§ã™ğŸ”¥";
      } else {
        msg.textContent =
          `ç¾åœ¨ã®é€£ç¶šãƒˆãƒ¬æ—¥æ•°ï¼š${streak}æ—¥ ğŸ”¥  /  ã“ã‚Œã¾ã§ã®è¨˜éŒ²ï¼š${totalLogs} ã‚»ãƒƒã‚·ãƒ§ãƒ³\n` +
          `ã€Œæ˜¨æ—¥ã®è‡ªåˆ†ã€ã‚’å°‘ã—ãšã¤ä¸Šå›ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`;
      }
    }

    // æ—¥ä»˜ã”ã¨ã®è¨˜éŒ²ä¸€è¦§
    function renderEntriesForDate(date) {
      const list = document.getElementById("date-entries-list");
      list.innerHTML = "";

      const dayLogs = logs
        .filter(l => l.date === date)
        .sort((a, b) => a.exercise.localeCompare(b.exercise));

      if (dayLogs.length === 0) {
        const empty = document.createElement("div");
        empty.style.fontSize = "11px";
        empty.style.color = "#6b7280";
        empty.textContent = "ã“ã®æ—¥ã®è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
        list.appendChild(empty);
        return;
      }

      dayLogs.forEach(entry => {
        const exInfo = EXERCISES.find(e => e.key === entry.exercise);
        const item = document.createElement("div");
        item.className = "entry-item";

        const main = document.createElement("div");
        main.className = "entry-main";

        const line1 = document.createElement("div");
        line1.textContent =
          `${exInfo ? exInfo.label : entry.exercise} / STEP ${entry.step} / ${entry.sets}ã‚»ãƒƒãƒˆ Ã— ${entry.repsPerSet}å›ï¼ˆåˆè¨ˆ${entry.totalReps}ï¼‰`;
        const line2 = document.createElement("div");
        line2.style.fontSize = "11px";
        line2.style.color = "#9ca3af";
        line2.textContent = entry.note || "ãƒ¡ãƒ¢ãªã—";

        main.appendChild(line1);
        main.appendChild(line2);

        const actions = document.createElement("div");
        actions.className = "entry-actions";

        const editBtn = document.createElement("button");
        editBtn.className = "secondary";
        editBtn.textContent = "ç·¨é›†";
        editBtn.addEventListener("click", () => {
          startEditEntry(entry);
        });

        const delBtn = document.createElement("button");
        delBtn.className = "secondary";
        delBtn.textContent = "å‰Šé™¤";
        delBtn.addEventListener("click", () => {
          deleteEntry(entry);
        });

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);

        item.appendChild(main);
        item.appendChild(actions);
        list.appendChild(item);
      });
    }

    function startEditEntry(entry) {
      editingId = entry.id;

      const dateInput = document.getElementById("date-input");
      const exSelect = document.getElementById("exercise-select");
      const stepSelect = document.getElementById("step-select");
      const repsInput = document.getElementById("reps-input");
      const setsInput = document.getElementById("sets-input");
      const noteInput = document.getElementById("note-input");
      const totalDisplay = document.getElementById("total-display");

      dateInput.value = entry.date;
      exSelect.value = entry.exercise;
      stepSelect.value = entry.step;
      repsInput.value = entry.repsPerSet;
      setsInput.value = entry.sets;
      noteInput.value = entry.note || "";
      totalDisplay.value = entry.totalReps;

      const exInfo = EXERCISES.find(e => e.key === entry.exercise);
      const banner = document.getElementById("edit-banner");
      const bannerText = document.getElementById("edit-banner-text");
      bannerText.textContent =
        `ç·¨é›†ä¸­: ${entry.date} / ${exInfo ? exInfo.label : entry.exercise} / STEP ${entry.step}`;
      banner.classList.add("visible");

      renderEntriesForDate(entry.date);
    }

    function cancelEdit() {
      editingId = null;
      const banner = document.getElementById("edit-banner");
      banner.classList.remove("visible");
    }

    function deleteEntry(entry) {
      if (!confirm("ã“ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
      logs = logs.filter(l => l.id !== entry.id);
      if (editingId === entry.id) {
        cancelEdit();
      }
      saveState();
      renderCalendar();
      renderAllCharts();
      renderWeeklyComparison();
      renderEntriesForDate(entry.date);
    }

    function initForm() {
      const dateInput = document.getElementById("date-input");
      const exSelect = document.getElementById("exercise-select");
      const stepSelect = document.getElementById("step-select");
      const repsInput = document.getElementById("reps-input");
      const setsInput = document.getElementById("sets-input");
      const totalDisplay = document.getElementById("total-display");
      const noteInput = document.getElementById("note-input");

      dateInput.value = todayISO();

      exSelect.innerHTML = "";
      EXERCISES.forEach(ex => {
        const opt = document.createElement("option");
        opt.value = ex.key;
        opt.textContent = ex.label;
        exSelect.appendChild(opt);
      });

      stepSelect.innerHTML = "";
      for (let i = 1; i <= 10; i++) {
        const opt = document.createElement("option");
        opt.value = i;
        opt.textContent = "STEP " + i;
        stepSelect.appendChild(opt);
      }

      exSelect.addEventListener("change", () => {
        if (editingId) return;
        const exKey = exSelect.value;
        const step = currentSteps[exKey] || 1;
        stepSelect.value = step;
      });
      exSelect.dispatchEvent(new Event("change"));

      function updateTotal() {
        const reps = Number(repsInput.value) || 0;
        const sets = Number(setsInput.value) || 0;
        totalDisplay.value = reps * sets;
      }
      repsInput.addEventListener("input", updateTotal);
      setsInput.addEventListener("input", updateTotal);
      updateTotal();

      dateInput.addEventListener("change", () => {
        renderEntriesForDate(dateInput.value);
      });

      document.getElementById("save-btn").addEventListener("click", () => {
        const date = dateInput.value;
        const exercise = exSelect.value;
        const step = Number(stepSelect.value);
        const repsPerSet = Number(repsInput.value);
        const sets = Number(setsInput.value);
        const note = noteInput.value.trim();

        if (!date) {
          alert("æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        if (!exercise) {
          alert("ç¨®ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
          return;
        }
        if (repsPerSet <= 0 || sets <= 0) {
          alert("ãƒ¬ãƒƒãƒ—ã‚¹æ•°ã¨ã‚»ãƒƒãƒˆæ•°ã¯1ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
          return;
        }

        const totalReps = repsPerSet * sets;

        if (editingId) {
          const idx = logs.findIndex(l => l.id === editingId);
          if (idx !== -1) {
            logs[idx] = {
              ...logs[idx],
              date,
              exercise,
              step,
              sets,
              repsPerSet,
              totalReps,
              note
            };
          }
          cancelEdit();
        } else {
          const id = Date.now().toString(36) + Math.random().toString(36).slice(2, 8);
          const entry = {
            id,
            date,
            exercise,
            step,
            sets,
            repsPerSet,
            totalReps,
            note
          };
          logs.push(entry);
        }

        const currentStepForEx = currentSteps[exercise] || 1;
        if (
          step === currentStepForEx &&
          sets >= STEPUP_MIN_SETS &&
          totalReps >= STEPUP_MIN_TOTAL_REPS &&
          currentStepForEx < 10
        ) {
          currentSteps[exercise] = currentStepForEx + 1;
          const exInfo = EXERCISES.find(e => e.key === exercise);
          showStepUpToast(`${exInfo ? exInfo.label : exercise} ãŒ STEP ${currentStepForEx} â†’ STEP ${currentStepForEx + 1} ã«ã‚¢ãƒƒãƒ—ï¼`);
        }

        saveState();
        renderCalendar();
        renderAllCharts();
        renderWeeklyComparison();
        renderEntriesForDate(date);

        if (!editingId) {
          noteInput.value = "";
        }

        alert("è¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼");
      });

      document.getElementById("clear-today-btn").addEventListener("click", () => {
        cancelEdit();
        dateInput.value = todayISO();
        exSelect.value = EXERCISES[0].key;
        exSelect.dispatchEvent(new Event("change"));
        repsInput.value = 10;
        setsInput.value = 3;
        noteInput.value = "";
        updateTotal();
        renderEntriesForDate(dateInput.value);
      });

      document.getElementById("cancel-edit-btn").addEventListener("click", () => {
        cancelEdit();
      });
    }

    // åè¨€
    function renderDailyQuote() {
      const quoteMain = document.getElementById("quote-main");
      const quoteMeta = document.getElementById("quote-meta");
      if (!quoteMain || !quoteMeta) return;

      const today = new Date();
      const dayOfYear = getDayOfYear(today);
      const len = QUOTES.length || 1;
      let index = (dayOfYear + quoteOffset) % len;
      if (index < 0) index += len;

      const q = QUOTES[index];
      quoteMain.textContent = `ã€Œ${q.text}ã€`;
      quoteMeta.textContent = `â€• ${q.author}ï¼ˆãƒ†ãƒ¼ãƒï¼š${q.theme}ï¼‰`;
    }

    // CSV
    function exportCSV() {
      if (logs.length === 0) {
        alert("ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚");
        return;
      }
      const header = ["id","date","exercise","step","sets","repsPerSet","totalReps","note"];
      const rows = [header.join(",")];

      logs.forEach(l => {
        const row = [
          l.id,
          l.date,
          l.exercise,
          l.step,
          l.sets,
          l.repsPerSet,
          l.totalReps,
          `"${(l.note || "").replace(/"/g, '""')}"`
        ];
        rows.push(row.join(","));
      });

      const csvContent = rows.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "prisoner_training_logs.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function resetAllData() {
      if (!confirm("æœ¬å½“ã«å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆå…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼‰")) return;
      logs = [];
      currentSteps = {};
      EXERCISES.forEach(ex => currentSteps[ex.key] = 1);
      editingId = null;
      saveState();
      renderCalendar();
      renderAllCharts();
      renderWeeklyComparison();
      const today = todayISO();
      document.getElementById("date-input").value = today;
      renderEntriesForDate(today);
      alert("å…¨ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadState();

      const todayLabel = document.getElementById("today-label");
      const today = parseISO(todayISO());
      todayLabel.textContent = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;

      currentMonth.year = today.getFullYear();
      currentMonth.month = today.getMonth() + 1;

      initForm();
      renderWeekdays();
      renderCalendar();
      renderLegend();
      renderAllCharts();
      renderWeeklyComparison();
      renderEntriesForDate(todayISO());

      renderDailyQuote();
      const nextQuoteBtn = document.getElementById("next-quote-btn");
      if (nextQuoteBtn) {
        nextQuoteBtn.addEventListener("click", () => {
          quoteOffset += 1;
          renderDailyQuote();
        });
      }

      document.getElementById("prev-month-btn").addEventListener("click", () => {
        let { year, month } = currentMonth;
        month--;
        if (month === 0) {
          month = 12;
          year--;
        }
        currentMonth.year = year;
        currentMonth.month = month;
        renderCalendar();
      });
      document.getElementById("next-month-btn").addEventListener("click", () => {
        let { year, month } = currentMonth;
        month++;
        if (month === 13) {
          month = 1;
          year++;
        }
        currentMonth.year = year;
        currentMonth.month = month;
        renderCalendar();
      });

      document.getElementById("export-csv-btn").addEventListener("click", exportCSV);
      document.getElementById("reset-all-btn").addEventListener("click", resetAllData);
    });
  </script>
</body>
</html>
